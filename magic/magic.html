<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Предсказание</title>

<style>
:root{
  --ink:#111;
  --cardTop: rgba(255,255,255,.62);
  --cardBot: rgba(255,255,255,.26);
  --shadow: rgba(0,0,0,.18);
}

html,body{
  height:100%;
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:
    radial-gradient(1200px 800px at 20% 10%, #eafff2 0%, #d8ffe7 18%, rgba(216,255,231,0) 55%),
    radial-gradient(900px 700px at 80% 25%, rgba(255,255,255,.45) 0%, rgba(255,255,255,0) 60%),
    linear-gradient(180deg, #0f4f34 0%, #0b3b2a 52%, #082c22 100%);
  overflow:hidden;
  color:var(--ink);
}

/* ---------- СНЕГ ---------- */
#snow{
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none;
}

/* ---------- ФОН ---------- */
.bg{
  position:fixed;
  inset:0;
  z-index:1;
  pointer-events:none;
}

.bg-lights{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  opacity:0.55;
  mix-blend-mode: screen;
}

/* ---------- ЁЛКА ---------- */
.tree{
  position:absolute;
  left: -75px;
  bottom: 120px;
  width: 210px;
  height:auto;
  transform: rotate(5deg);
  transform-origin: 65% 85%;
  opacity: 0.16;
  filter: drop-shadow(0 10px 18px rgba(0,0,0,0.10));
  pointer-events:none;
}
@media (min-width: 520px){
  .tree{
    left: -130px;
    bottom: 240px;
    width: 280px;
    opacity: 0.13;
    transform: rotate(45deg);
  }
}

/* огоньки на ёлке */
.light{ opacity:0.35; }
.l1{ fill:#ff4d4d; animation: twinkle 1.2s infinite; }
.l2{ fill:#4da3ff; animation: twinkle 1.1s infinite; animation-delay:.15s; }
.l3{ fill:#ffd24d; animation: twinkle 1.3s infinite; animation-delay:.28s; }
.l4{ fill:#6bff9d; animation: twinkle 1.15s infinite; animation-delay:.42s; }
.l5{ fill:#b56bff; animation: twinkle 1.25s infinite; animation-delay:.55s; }

@keyframes twinkle{
  0%,100%{ opacity:.25; filter:none; }
  50%{ opacity:.98; filter: drop-shadow(0 0 10px rgba(255,255,255,.55)); }
}

/* ---------- ГИРЛЯНДА ---------- */
.garland{
  position:fixed;
  top:65px;
  right:-20px;
  z-index:3;
  width:min(360px, 46vw);
  height:90px;
  pointer-events:none;
  opacity:.95;
  filter: drop-shadow(0 10px 18px rgba(0,0,0,.25));
  transform: rotate(30deg);
  transform-origin: 100% 0%;
}
.garland svg{ width:100%; height:100%; display:block; }

.wire{
  stroke: rgba(10,10,10,.45);
  stroke-width: 5;
  stroke-linecap: round;
  fill: none;
}

.bulb{
  animation: blink 1.15s infinite;
  transform-origin: center;
}
.bulb:nth-child(3n){ animation-duration: 1.05s; animation-delay:.12s; }
.bulb:nth-child(4n){ animation-duration: 1.25s; animation-delay:.22s; }
.bulb:nth-child(5n){ animation-duration: 0.95s; animation-delay:.18s; }

@keyframes blink{
  0%,100% { opacity:.35; filter:none; transform: translateY(0px) scale(1); }
  50%     { opacity:1;   filter: drop-shadow(0 0 10px rgba(255,255,255,.65)); transform: translateY(-1px) scale(1.02); }
}

/* ---------- КОНТЕНТ ---------- */
.wrap{
  position:relative;
  z-index:2;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
  text-align:center;
  transform: translateY(-36px);
}

.ui{
  width:min(560px,100%);
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:14px;
  padding:18px 18px 20px;
  border-radius:22px;
  background: linear-gradient(180deg, var(--cardTop) 0%, var(--cardBot) 100%);
  backdrop-filter: blur(12px);
  box-shadow: 0 26px 70px rgba(0,0,0,.18);
  border: 1px solid rgba(255,255,255,.45);
  position: relative;
  overflow:hidden;
}

/* блик сверху */
.ui::before{
  content:"";
  position:absolute;
  left:-10%;
  right:-10%;
  top:-35%;
  height:60%;
  background: radial-gradient(circle at 30% 20%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%);
  transform: rotate(-8deg);
  pointer-events:none;
}

h1{
  margin:0;
  font-size:20px;
  font-weight:900;
  letter-spacing:.2px;
}

.subtitle{
  font-size:13px;
  opacity:.75;
}

/* ---------- СПИРАЛЬ ---------- */
.spiral-wrap{
  position:relative;
  width:230px;
  height:230px;
  display:grid;
  place-items:center;
  margin:10px 0;
  filter: drop-shadow(0 18px 40px rgba(0,0,0,0.18));
}

.ball{
  position:absolute;
  inset:10px;
  border-radius:50%;
  background:
    radial-gradient(circle at 30% 28%, rgba(255,255,255,.95), rgba(255,255,255,0) 45%),
    radial-gradient(circle at 55% 65%, #FFEFA3 0%, #FFD900 55%, #F5C400 100%);
  box-shadow:
    inset 0 0 0 2px rgba(255,255,255,.25),
    0 18px 35px rgba(0,0,0,.18);
}

.spinner{
  width:230px;
  height:230px;
  display:grid;
  place-items:center;
  transform-origin:50% 50%;
  will-change: transform;
  transform: rotate(0deg);
}

.spiral{
  width:210px;
  height:210px;
}

/* ---------- ТЕКСТ ---------- */
.status{
  font-size:13px;
  opacity:.75;
  min-height:18px;
}

.pred{
  font-size:18px;
  font-weight:800;
  min-height:56px;
}

/* ---------- КНОПКА ---------- */
.btn{
  width:min(360px,100%);
  border:0;
  border-radius:18px;
  padding:14px 16px;
  font-size:16px;
  font-weight:900;
  background:#0b1611;
  color:#fff;
  cursor:pointer;
  box-shadow: 0 12px 26px rgba(0,0,0,.22);
}
.btn:disabled{ opacity:.6; cursor:not-allowed; }
.btn:active{ transform: translateY(1px); }
</style>

<!-- Yandex.Metrika counter (ID: 105995808) -->
<script type="text/javascript">
  (function(m,e,t,r,i,k,a){
      m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
      m[i].l=1*new Date();
      for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
      k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
  })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105995808', 'ym');

  ym(105995808, 'init', {
    webvisor:false,
    clickmap:true,
    accurateTrackBounce:true,
    trackLinks:true
  });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105995808" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

</head>

<body>
<canvas id="snow"></canvas>

<!-- Гирлянда -->
<div class="garland" aria-hidden="true">
  <svg viewBox="0 0 360 90" preserveAspectRatio="none">
    <path class="wire" d="M10,30 C80,10 140,55 210,30 C270,12 310,40 350,22"/>
    <g>
      <g class="bulb">
        <rect x="36.5" y="22" width="7" height="6" rx="2" fill="rgba(20,20,20,.55)"/>
        <circle cx="40" cy="34" r="9" fill="#ff4d4d"/><circle cx="40" cy="46" r="6" fill="#ff4d4d"/>
      </g>
      <g class="bulb">
        <rect x="74.5" y="16" width="7" height="6" rx="2" fill="rgba(20,20,20,.55)"/>
        <circle cx="78" cy="28" r="9" fill="#ffd24d"/><circle cx="78" cy="40" r="6" fill="#ffd24d"/>
      </g>
      <g class="bulb">
        <rect x="114.5" y="26" width="7" height="6" rx="2" fill="rgba(20,20,20,.55)"/>
        <circle cx="118" cy="38" r="9" fill="#4da3ff"/><circle cx="118" cy="50" r="6" fill="#4da3ff"/>
      </g>
      <g class="bulb">
        <rect x="152.5" y="34" width="7" height="6" rx="2" fill="rgba(20,20,20,.55)"/>
        <circle cx="156" cy="46" r="9" fill="#6bff9d"/><circle cx="156" cy="58" r="6" fill="#6bff9d"/>
      </g>
      <g class="bulb">
        <rect x="192.5" y="22" width="7" height="6" rx="2" fill="rgba(20,20,20,.55)"/>
        <circle cx="196" cy="34" r="9" fill="#b56bff"/><circle cx="196" cy="46" r="6" fill="#b56bff"/>
      </g>
      <g class="bulb">
        <rect x="232.5" y="16" width="7" height="6" rx="2" fill="rgba(20,20,20,.55)"/>
        <circle cx="236" cy="28" r="9" fill="#ffd24d"/><circle cx="236" cy="40" r="6" fill="#ffd24d"/>
      </g>
      <g class="bulb">
        <rect x="272.5" y="28" width="7" height="6" rx="2" fill="rgba(20,20,20,.55)"/>
        <circle cx="276" cy="40" r="9" fill="#ff4d4d"/><circle cx="276" cy="52" r="6" fill="#ff4d4d"/>
      </g>
      <g class="bulb">
        <rect x="312.5" y="18" width="7" height="6" rx="2" fill="rgba(20,20,20,.55)"/>
        <circle cx="316" cy="30" r="9" fill="#4da3ff"/><circle cx="316" cy="42" r="6" fill="#4da3ff"/>
      </g>
    </g>
  </svg>
</div>

<div class="bg" aria-hidden="true">
  <svg class="bg-lights" viewBox="0 0 1000 700" preserveAspectRatio="none">
    <defs>
      <radialGradient id="g1" cx="20%" cy="25%" r="60%">
        <stop offset="0%" stop-color="#ffffff" stop-opacity="0.55"/>
        <stop offset="55%" stop-color="#ffffff" stop-opacity="0.08"/>
        <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
      </radialGradient>
      <radialGradient id="g2" cx="78%" cy="35%" r="70%">
        <stop offset="0%" stop-color="#ffffff" stop-opacity="0.45"/>
        <stop offset="60%" stop-color="#ffffff" stop-opacity="0.10"/>
        <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
      </radialGradient>
    </defs>
    <rect width="1000" height="700" fill="url(#g1)"/>
    <rect width="1000" height="700" fill="url(#g2)"/>
  </svg>

  <svg class="tree" viewBox="0 0 260 340">
    <path d="M130 40 L55 150 H205 Z" fill="#2f7a40"/>
    <path d="M130 95 L40 230 H220 Z" fill="#2b6b3a"/>
    <path d="M130 155 L30 305 H230 Z" fill="#33884a"/>
    <rect x="112" y="300" width="36" height="40" rx="10" fill="#7a4b2a"/>
    <path d="M70 155 C95 130 115 170 145 150 C170 135 190 175 205 165"
          fill="none" stroke="rgba(255,255,255,0.35)" stroke-width="3" stroke-linecap="round"/>
    <circle class="light l1" cx="82" cy="150" r="6"/>
    <circle class="light l2" cx="110" cy="162" r="6"/>
    <circle class="light l3" cx="140" cy="150" r="6"/>
    <circle class="light l4" cx="168" cy="160" r="6"/>
    <circle class="light l5" cx="196" cy="165" r="6"/>
  </svg>
</div>

<div class="wrap">
  <div class="ui">
    <h1>Предсказание на год</h1>
    <div class="subtitle">Нажми кнопку — спиралька прокрутится</div>

    <div class="spiral-wrap">
      <div class="ball"></div>
      <div class="spinner" id="spinner">
        <svg class="spiral" viewBox="0 0 220 220">
          <path id="spiralPath" fill="none" stroke="#111" stroke-width="12"
                stroke-linecap="round" stroke-linejoin="round"
                style="filter: drop-shadow(0 1px 0 rgba(255,255,255,.22));"/>
        </svg>
      </div>
    </div>

    <div class="status" id="status">Готово</div>
    <div class="pred" id="pred">…</div>
    <button class="btn" id="btn">Получить предсказание</button>
  </div>
</div>

<script>
/* ========= НАСТРОЙКИ ========= */
const METRIKA_ID = 105995808;
const LOCAL_LOG_ENDPOINT = "http://127.0.0.1:8787/event"; // optional
/* ============================= */

function track(eventName, payload={}){
  if (typeof ym === "function" && METRIKA_ID){
    try { ym(METRIKA_ID, "reachGoal", eventName, payload); } catch(e){}
  }
  // локальный лог — опционально (если логгер не запущен, просто молча игнорим)
  try{
    fetch(LOCAL_LOG_ENDPOINT, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({
        event: eventName,
        payload,
        ts: new Date().toISOString(),
        page: location.href,
        ua: navigator.userAgent
      })
    }).catch(()=>{});
  }catch(e){}
}

/* активация страницы */
track("activation");

/* ===== СПИРАЛЬ ===== */
(function buildSpiral(){
  const cx=110, cy=110, a=2, b=3.55;
  const max=5.35*Math.PI, step=.1;
  let d="", first=true;

  for(let t=0;t<=max;t+=step){
    const r=a+b*t;
    const x=cx+r*Math.cos(t);
    const y=cy+r*Math.sin(t);
    d+=`${first?"M":"L"} ${x.toFixed(2)} ${y.toFixed(2)} `;
    first=false;
  }
  document.getElementById("spiralPath").setAttribute("d", d);
})();

/* ===== ПРЕДСКАЗАНИЯ ===== */
const PRED=[
  "Этот год будет про простые и верные решения.",
  "Весной появится шанс, который нельзя откладывать.",
  "Ты сделаешь шаг, который долго боялся сделать.",
  "В этом году ты удивишься собственной смелости.",
  "К концу года многое встанет на свои места."
];

const btn=document.getElementById("btn");
const pred=document.getElementById("pred");
const status=document.getElementById("status");
const spinner=document.getElementById("spinner");

let angle=0, anim=null;

btn.onclick=async()=>{
  track("predict_click");

  btn.disabled=true;
  pred.textContent="…";
  status.textContent="Крутим спиральку…";

  const delta=(2+Math.random()*2)*360+Math.random()*360;
  const start=angle;
  angle+=delta;

  if(anim) anim.cancel();
  anim=spinner.animate(
    [{transform:`rotate(${start}deg)`},{transform:`rotate(${angle}deg)`}],
    {duration:2200+Math.random()*800,easing:"cubic-bezier(.2,.9,.2,1)",fill:"forwards"}
  );
  await anim.finished;
  spinner.style.transform=`rotate(${angle}deg)`;

  pred.textContent=PRED[Math.floor(Math.random()*PRED.length)];
  status.textContent="Готово";
  btn.disabled=false;
};

/* ===== СНЕГ ===== */
const c=document.getElementById("snow"),ctx=c.getContext("2d");
let w,h;
const flakes=[];
let wind=0;

function resize(){
  w=c.width=innerWidth;
  h=c.height=innerHeight;
}
resize();
addEventListener("resize",resize);

function seedSnow(){
  flakes.length=0;
  const count = Math.round(Math.min(560, Math.max(300, (w*h)/5600)));
  for(let i=0;i<count;i++){
    const layer = Math.random();
    flakes.push({
      x: Math.random()*w,
      y: Math.random()*h,
      r: 0.6 + Math.random()*3.8 * (0.25 + layer),
      v: 0.4 + Math.random()*2.8 * (0.18 + layer),
      a: 0.18 + Math.random()*0.65 * (0.20 + layer),
      sway: 0.4 + Math.random()*1.9,
      phase: Math.random()*Math.PI*2
    });
  }
}
seedSnow();
addEventListener("resize", seedSnow);

(function snow(t=0){
  ctx.clearRect(0,0,w,h);
  wind = Math.sin(t/1800)*0.95;

  for(const f of flakes){
    f.y += f.v;
    f.x += wind*0.7 + Math.sin(t/700 + f.phase)*f.sway*0.25;

    if(f.y > h+14){ f.y = -14; f.x = Math.random()*w; }
    if(f.x < -22) f.x = w+22;
    if(f.x > w+22) f.x = -22;

    ctx.beginPath();
    ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
    ctx.fillStyle = `rgba(255,255,255,${f.a})`;
    ctx.fill();

    if(f.r > 2.6 && Math.random() < 0.10){
      ctx.beginPath();
      ctx.arc(f.x - f.r*0.35, f.y - f.r*0.35, f.r*0.35, 0, Math.PI*2);
      ctx.fillStyle = `rgba(255,255,255,${Math.min(1, f.a+0.22)})`;
      ctx.fill();
    }
  }
  requestAnimationFrame(snow);
})();
</script>
</body>
</html>





<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Анти‑инфоповод — стоит ли постить?</title>
  <style>
    :root{
      --bg:#0b0c10; --card:#111218; --ink:#eaecef; --muted:#9aa0a6; --acc:#7cdd5c; --warn:#ffb020; --bad:#ff5d5d; --ok:#4db5ff;
      --edge:12px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b0c10,#0e1016);color:var(--ink);font:16px/1.5 system-ui,Segoe UI,Roboto}
    header{position:sticky;top:0;z-index:5;background:#0b0c10cc;backdrop-filter:blur(6px);border-bottom:1px solid #222}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    h1{font-size:26px;margin:6px 0 10px}
    .sub{color:var(--muted);font-size:14px}

    .grid{display:grid;gap:16px;grid-template-columns:1fr}
    @media(min-width:960px){.grid{grid-template-columns:1.1fr .9fr}}

    .card{background:var(--card);border:1px solid #1e2230;border-radius:var(--edge);padding:16px;box-shadow:0 8px 24px #0008}
    .card h2{margin:0 0 10px;font-size:18px}

    label small{color:var(--muted)}
    .row{display:grid;gap:10px;margin:10px 0}
    .row.cols{grid-template-columns:repeat(2,minmax(0,1fr))}

    .field{display:flex;flex-direction:column;gap:6px}

    input[type=text],input[type=number],select,textarea{width:100%;background:#0c0f16;border:1px solid #242a3a;color:var(--ink);padding:10px;border-radius:10px;outline:none}
    textarea{min-height:68px;resize:vertical}
    input[type=range]{width:100%}
    .hint{font-size:12px;color:var(--muted)}

    .scale{display:flex;justify-content:space-between;font-size:12px;color:var(--muted)}

    .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;font-size:12px;border:1px solid #283046;background:#101522}
    .pill.bad{border-color:#3b1c1c;background:#1a1111;color:#ffb4b4}
    .pill.ok{border-color:#193045;background:#0f1620;color:#b7dcff}
    .pill.good{border-color:#1f3522;background:#0f1a12;color:#b9f6a8}

    .btns{display:flex;gap:10px;flex-wrap:wrap}
    .btn{background:#121828;border:1px solid #2a3350;color:#e6ecff;padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn:hover{border-color:#3a4a7a}
    .btn.primary{background:#14240f;border-color:#284a1c;color:#d7ffd0}
    .btn.warn{background:#2a1f0f;border-color:#664520;color:#ffe1b3}

    .meter{height:12px;background:#0d111a;border:1px solid #222a3a;border-radius:999px;position:relative;overflow:hidden}
    .meter>i{position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,var(--bad),var(--warn),var(--acc));transition:width .3s}
    .meter-legend{display:flex;justify-content:space-between;font-size:12px;color:var(--muted)}

    .result h3{margin:0 0 8px}
    .result .status{font-weight:700}
    .status.do{color:var(--acc)}
    .status.consider{color:var(--warn)}
    .status.dont{color:var(--bad)}

    .list{margin:8px 0 0;padding-left:18px}
    .list li{margin:4px 0}

    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;background:#0b0f16;padding:2px 6px;border-radius:6px;border:1px solid #222b3a}

    footer{color:#768093;padding:20px 0;text-align:center}

    /* Печатная версия */
    @media print{
      body{background:#fff;color:#000}
      header{position:static;background:#fff;border:none}
      .card{box-shadow:none;border-color:#ddd}
      .btns{display:none}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Анти‑инфоповод</h1>
      <div class="sub">Сделано для быстрых решений: постить или выкинуть</div>
    </div>
  </header>

  <main class="wrap grid">
    <section class="card" id="formCard">
      <h2>Карточка инфоповода</h2>

      <div class="row">
        <div class="field">
          <label for="title">Название</label>
          <input id="title" type="text" placeholder="Инфоповод в 2–3 словах"/>
          <div class="hint">Если нельзя сформулировать в 2–3 словах — это плохой инфоповод.</div>
        </div>
      </div>

      <div class="row cols">
        <div class="field">
          <label for="format">Формат</label>
          <select id="format">
            <option value="post">Пост</option>
            <option value="story">Сторис или карусель</option>
            <option value="video">Короткое видео</option>
            <option value="longread">Лонгрид или гайд</option>
            <option value="push">Пуш или баннер в приложении</option>
            <option value="email">Письмо</option>
            <option value="other">Другое</option>
          </select>
        </div>
        <div class="field">
          <label for="source">Источник</label>
          <select id="source">
            <option>Официальный релиз</option>
            <option>Слухи или инсайды</option>
            <option>Крупные медиа</option>
            <option>Телеграм‑каналы</option>
            <option>Пользовательские отзывы</option>
            <option>Собственная аналитика или данные</option>
          </select>
          <div class="hint"></div>
        </div>
      </div>

      <div class="row cols">
        <div class="field">
          <label for="heardAt">Когда впервые узнали?</label>
          <input id="heardAt" type="date" />
        </div>
        <div class="field">
          <label for="expiresAt">Когда «протухнет»?</label>
          <input id="expiresAt" type="date" />
        </div>
      </div>

      <div class="row cols">
        <div class="field">
          <label for="writeHours">Время на написание</label>
          <input id="writeHours" type="number" min="0" step="0.5" value="1" placeholder="Измеряется в часах" />
        </div>
        <div class="field">
          <label for="approveHours">Время на согласование</label>
          <input id="approveHours" type="number" min="0" step="0.5" value="2" placeholder="Измеряется в часах" />
        </div>
      </div>

      <div class="row cols">
        <div class="field">
          <label for="uniq">Уникальность</label>
          <input id="uniq" type="range" min="0" max="10" value="5" />
          <div class="scale"><span>0 — рерайт</span><span>10 — инсайд</span></div>
        </div>
        <div class="field">
          <label for="value">Польза</label>
          <input id="value" type="range" min="0" max="10" value="6" />
          <div class="scale"><span>0 — «ну и что?»</span><span>10 — must‑read</span></div>
        </div>
      </div>

      <div class="row cols">
        <div class="field">
          <label for="risk">Токсичность темы</label>
          <input id="risk" type="range" min="0" max="10" value="3" />
          <div class="scale"><span>0 — безопасно</span><span>10 — придут юристы</span></div>
        </div>
        <div class="field">
          <label for="brand">Соответствие тону бренда</label>
          <input id="brand" type="range" min="0" max="10" value="7" />
          <div class="scale"><span>0 — неуместное</span><span>10 — «наш голос!»</span></div>
        </div>
      </div>

      <div class="row cols">
        <div class="field">
          <label for="noise">Конкурирующие поводы</label>
          <input id="noise" type="range" min="0" max="10" value="4" />
          <div class="scale"><span>0 — все молчат</span><span>10 — уже написали федералы</span></div>
        </div>
        <div class="field">
          <label for="evergreen">Вечнозелёное</label>
          <input id="evergreen" type="range" min="0" max="10" value="5" />
          <div class="scale"><span>0 — здесь и сейчас</span><span>10 — потерпит до понедельника</span></div>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="thesis">Кому это больно или полезно? Ключевая мысль</label>
          <textarea id="thesis" placeholder="Один тезис: что меняется для читателя и почему это важно"></textarea>
        </div>
      </div>

      <div class="btns">
        <button class="btn primary" id="calc">Рассчитать рекомендацию</button>
        <button class="btn warn" id="reset">Сбросить</button>
      </div>
    </section>

    <aside class="card" id="resultCard">
      <h2>Результат</h2>
      <div class="row">
        <div class="pill ok" id="statusPill">Готов к оценке</div>
      </div>
      <div class="meter" title="Итоговый балл">
        <i id="meterFill"></i>
      </div>
      <div class="meter-legend"><span>0</span><span>50</span><span>100</span></div>

      <div class="result" id="result">
        <h3>Статус: <span class="status" id="statusText">—</span></h3>
        <div id="scoreLine" class="hint">Баллы появятся после расчёта</div>
        <h3 style="margin-top:16px">Почему так</h3>
        <ul class="list" id="whyList"></ul>
        <h3 style="margin-top:16px">Что поправить редактору</h3>
        <ul class="list" id="adviceList"></ul>
        <h3 style="margin-top:16px">Чек‑лист перед публикацией</h3>
        <ul class="list">
          <li>Тезис формулируется в <span class="kbd">одном предложении</span>.</li>
          <li>Первая строка/картинка конкурирует за внимание с лентой дня.</li>
          <li>Проверены факты, цифры, сроки; есть первоисточник.</li>
          <li>Понимаем, что делать читателю: действие/выгода/ссылка.</li>
          <li>План реакции на негатив/вопросы у саппорта.</li>
        </ul>
        <div class="btns" style="margin-top:16px">
          <button class="btn" id="downloadJson">Скачать JSON</button>
          <button class="btn" id="downloadPdf">Скачать PDF</button>
        </div>
      </div>
    </aside>
  </main>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const fields = ["title","format","source","heardAt","expiresAt","writeHours","approveHours","uniq","value","risk","brand","noise","evergreen","thesis"];

  // --- Расчёт ---
  function parseNum(id){ return parseFloat($(id).value)||0; }

  function calcAndExplain(){
    const uniq=parseNum("uniq"), value=parseNum("value"), risk=parseNum("risk"), brand=parseNum("brand"), noise=parseNum("noise"), evergreen=parseNum("evergreen");
    const writeH=parseNum("writeHours"), approveH=parseNum("approveHours");

    const timePenalty = Math.min(10, Math.max(0, writeH + approveH)); // 0..10

    // Базовая формула (максимум положительных = 65 баллов)
    const MAX_POS = 30 + 20 + 15; // value*3 + uniq*2 + brand*1.5
    let raw = value*3 + uniq*2 + brand*1.5 - risk*2 - noise*1 - timePenalty;

    // Нормализация к 0..100
    let norm = Math.round( Math.max(0, Math.min(100, (raw / MAX_POS) * 100)) );

    const why=[]; const adv=[];
    if(value>=7) why.push("Высокая практическая польза"); else adv.push("Добавить выгоды/CTA");
    if(uniq>=7) why.push("Есть эксклюзив/оригинальность"); else adv.push("Найти свежий угол");
    if(brand>=7) why.push("Вписывается в тон бренда"); else adv.push("Подправить тон/формулировки");
    if(risk>=6) adv.push("Высокая токсичность — нужна юр/GR‑проверка");
    if(noise>=6) adv.push("Высокий шум — усилить заход или сменить окно");
    if(evergreen>=7) adv.push("Можно сделать evergreen‑материал");

    let status = "—", cls = "", pill = "ok";
    if(norm>=70){ status="Постить"; cls="do"; pill="good"; }
    else if(norm>=50){ status="Под вопросом"; cls="consider"; pill="ok"; }
    else { status="Не постить"; cls="dont"; pill="bad"; }

    return {raw, norm, why, adv, status, cls, pill};
  }

  function render(){
    const r = calcAndExplain();
    $("meterFill").style.width=r.norm+"%";
    $("statusText").textContent=r.status;
    $("statusText").className="status "+r.cls;
    $("statusPill").className="pill "+r.pill;
    $("statusPill").textContent=`Итог: ${r.norm}/100`;
    $("scoreLine").textContent=`Пороговые значения: ≥70 — постим; 50–69 — доработать; <50 — не постим.`;
    $("whyList").innerHTML=r.why.map(x=>`<li>${x}</li>`).join("")||'<li>Нет особых факторов.</li>';
    $("adviceList").innerHTML=r.adv.map(x=>`<li>${x}</li>`).join("")||'<li>Выглядит готово.</li>';
  }

  // Лайв‑обновление при вводе и смене полей
  fields.forEach(id=>{
    const el=$(id);
    if(el){ ['input','change'].forEach(evt=> el.addEventListener(evt,render)); }
  });
  $("calc").addEventListener('click',render);

  // --- Экспорт ---
  function collectCurrent(){
    return Object.fromEntries(fields.map(id=>[id,$(id).value]));
  }

  function downloadFile(filename, blob){
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url; a.download=filename; a.click();
    setTimeout(()=>URL.revokeObjectURL(url),1000);
  }

  $("downloadJson").addEventListener('click',()=>{
    const payload=collectCurrent();
    const r = calcAndExplain();
    const blob=new Blob([JSON.stringify({...payload, score:r.norm, status:r.status},null,2)],{type:'application/json'});
    downloadFile('antinote-current.json',blob);
  });

  function openPrintPdf(){
  const data = collectCurrent();
  const r = calcAndExplain();
  const now = new Date().toLocaleString();
  const html = `<!doctype html><html><head><meta charset="utf-8"><title>Анти-инфоповод — отчёт</title>
  <style>
    body{font:14px/1.45 system-ui,Segoe UI,Roboto;color:#111;padding:24px}
    h1{margin:0 0 8px;font-size:20px}
    .muted{color:#555}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #ccc;margin-left:8px}
    .good{background:#eaf7e6;border-color:#b8e3a8}
    .ok{background:#eef4ff;border-color:#c9dafd}
    .bad{background:#ffecec;border-color:#ffc7c7}
    table{width:100%;border-collapse:collapse;margin:12px 0}
    td,th{padding:8px;border:1px solid #ddd;vertical-align:top}
    ul{margin:6px 0 0}
    .small{font-size:12px;color:#666}
  </style></head><body>
  <h1>Анти-инфоповод — отчёт <span class="badge ${r.pill}">${r.status} • ${r.norm}/100</span></h1>
  <div class="muted">Сформировано: ${now}</div>
  <table>
    <tr><th>Название</th><td>${(data.title||'').replace(/</g,'&lt;')}</td></tr>
    <tr><th>Формат</th><td>${data.format||''}</td></tr>
    <tr><th>Источник</th><td>${data.source||''}</td></tr>
    <tr><th>Когда узнали</th><td>${data.heardAt||'—'}</td></tr>
    <tr><th>Когда «протухнет»</th><td>${data.expiresAt||'—'}</td></tr>
    <tr><th>Время (ч)</th><td>Написание: ${data.writeHours||'0'}; Согласование: ${data.approveHours||'0'}</td></tr>
    <tr><th>Шкалы 0–10</th><td>
      Уникальность: ${data.uniq}/10; Польза: ${data.value}/10; Токсичность: ${data.risk}/10; Бренд: ${data.brand}/10; Шум: ${data.noise}/10; Вечнозелёное: ${data.evergreen}/10
    </td></tr>
    <tr><th>Тезис</th><td>${(data.thesis||'').replace(/</g,'&lt;')}</td></tr>
  </table>
  <h3>Почему так</h3>
  <ul>${r.why.map(x=>`<li>${x}</li>`).join('')||'<li>Нет особых факторов.</li>'}</ul>
  <h3>Что поправить редактору</h3>
  <ul>${r.adv.map(x=>`<li>${x}</li>`).join('')||'<li>Выглядит готово.</li>'}</ul>
  <p class="small">Подсказка: в диалоге печати выберите «Сохранить как PDF».</p>
  <script>setTimeout(()=>window.print(),200);<\/script>
  </body></html>`;

  const w = window.open('', '_blank');
  if(!w){ alert('Откройте всплывающее окно для печати PDF.'); return; }
  w.document.open(); w.document.write(html); w.document.close(); w.focus();
}

  $("downloadPdf").addEventListener('click', openPrintPdf);

  // --- История ---
  function renderHistory(){
    const box = $("history");
    const store = JSON.parse(localStorage.getItem("antiNewsHistory")||"[]");
    if(!store.length){ box.textContent = "Пусто"; return; }
    box.innerHTML = store.map(item=>{
      const d = new Date(item.savedAt).toLocaleString();
      const badge = item.score>=70? 'good' : item.score>=50? 'ok' : 'bad';
      const label = item.score>=70? 'Постить' : item.score>=50? 'Под вопросом' : 'Не постить';
      return `<div class="card" style="margin:10px 0;padding:12px">
        <div style="display:flex;justify-content:space-between;gap:12px;align-items:center;flex-wrap:wrap">
          <div>
            <div style="font-weight:700">${(item.title||"(без названия)").replace(/</g,'&lt;')}</div>
            <div class="hint">${d} • ${item.format||"формат?"} • Итог: ${item.score}/100</div>
          </div>
          <div class="pill ${badge}">${label}</div>
        </div>
      </div>`
    }).join("");
  }

  function saveCase(){
    const data = collectCurrent();
    const r = calcAndExplain();
    const item = { ...data, score: r.norm, status: r.status, savedAt: new Date().toISOString() };
    const store = JSON.parse(localStorage.getItem("antiNewsHistory")||"[]");
    store.unshift(item);
    localStorage.setItem("antiNewsHistory", JSON.stringify(store));
    renderHistory();
  }

  $("save").addEventListener('click', ()=>{ render(); saveCase(); });

  // Сброс к дефолтам
  $("reset").addEventListener('click', ()=>{
    ["title","thesis"].forEach(id=>$(id).value="");
    $("format").value="post";
    $("source").value="Официальный релиз";
    ["heardAt","expiresAt"].forEach(id=>$(id).value="");
    $("writeHours").value="1";
    $("approveHours").value="2";
    $("uniq").value="5";
    $("value").value="6";
    $("risk").value="3";
    $("brand").value="7";
    $("noise").value="4";
    $("evergreen").value="5";
    render();
  });

  // Первый рендер
  render();
  renderHistory();
})();
</script>
</body>
</html>

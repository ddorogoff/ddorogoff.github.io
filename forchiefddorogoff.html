<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SMS‑калькулятор</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root{--bg:#0b0c10;--panel:#121419;--panel2:#151821;--text:#e6e8ee;--muted:#9aa3b2;--brand:#6aa6ff;--accent:#77f2c8;--border:#232635;--ring:#2a2f42;--shadow:0 10px 28px rgba(0,0,0,.35)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:linear-gradient(180deg,#0c0e13,#0b0c10)}
    .wrap{max-width:960px;margin:0 auto;padding:20px}
    header{position:sticky;top:0;z-index:10;background:rgba(12,14,19,.6);backdrop-filter:saturate(130%) blur(6px);border-bottom:1px solid var(--border)}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--brand),var(--accent));box-shadow:var(--shadow)}
    .brand h1{margin:0;font-size:18px}
    .brand span{display:block;color:var(--muted);font-size:12px;margin-top:2px}

    .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
    .body{padding:16px}

    .grid{display:grid;gap:16px;grid-template-columns:1fr 360px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}

    .h3{margin:0 0 8px 0;font-size:16px}
    .controls{display:grid;gap:14px}
    .row{display:grid;gap:8px}
    .label{color:var(--muted);font-size:13px}

    .select,.text,.rangeWrap{width:100%}
    .radioGroup{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:9px 12px;border-radius:999px;border:1px solid var(--border);background:#0f1117;cursor:pointer}
    .chip.active{outline:2px solid var(--ring)}
    input[type="range"]{width:100%}
    .hint{display:flex;justify-content:space-between;color:var(--muted);font-size:12px}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:#0f1117;color:var(--muted);font-size:12px}

    .summary{display:grid;gap:10px}
    .line{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#0f1117}
    .big{font-size:22px;font-weight:700}
    .muted{color:var(--muted);font-size:12px}

    button{padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:#0f1117;color:var(--text);cursor:pointer}
    .primary{background:linear-gradient(135deg,var(--brand),var(--accent));border:none;color:#0b0c10;font-weight:700}

    .foot{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .badge{padding:2px 8px;border-radius:999px;background:rgba(119,242,200,.14);color:var(--accent);border:1px solid rgba(119,242,200,.28);font-weight:600;font-size:11px}
    .note{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;justify-content:space-between;align-items:center;gap:16px">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Крутая компания</h1>
          <span>SMS‑калькулятор стоимости</span>
        </div>
      </div>
      <div class="foot">
        <label class="pill"><input type="checkbox" id="vat" style="accent-color:var(--brand)" checked> с НДС 20%</label>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <!-- LEFT: Inputs -->
      <div class="card">
        <div class="body">
          <h3 class="h3">Параметры рассылки</h3>
          <div class="controls">

            <div class="row">
              <div class="label">Регион доставки</div>
              <div id="region" class="radioGroup">
                <button class="chip active" data-id="ru">Россия</button>
                <button class="chip" data-id="cis">СНГ</button>
                <button class="chip" data-id="eu">Европа</button>
                <button class="chip" data-id="ww">Остальной мир</button>
              </div>
              <div class="note">Цена за <u>1 сегмент</u> зависит от региона и объёма (внутренние референс‑цены для пресейла).</div>
            </div>

            <div class="row">
              <div class="label">Сообщений в месяц</div>
              <div class="rangeWrap">
                <input id="messages" type="range" min="500" max="1000000" value="20000" step="100">
                <div class="hint"><span>500</span><span id="messagesOut">20 000</span><span>1 000 000+</span></div>
              </div>
            </div>

            <div class="row">
              <div class="label">Средняя длина сообщения (символов)</div>
              <div class="rangeWrap">
                <input id="chars" type="range" min="10" max="500" value="120" step="1">
                <div class="hint"><span>10</span><span id="charsOut">120</span><span>500</span></div>
              </div>
            </div>

            <div class="row">
              <div class="label">Кодировка</div>
              <div id="enc" class="radioGroup">
                <button class="chip active" data-id="gsm">GSM 7‑bit</button>
                <button class="chip" data-id="uni">Unicode (UTF‑16)</button>
              </div>
              <div class="note">GSM: 160 / 153 символов на сегмент; Unicode: 70 / 67 символов.</div>
            </div>

            <div class="row">
              <div class="label">Альфа‑имя (аренда)</div>
              <div id="alfa" class="radioGroup">
                <button class="chip active" data-id="none">Не нужен</button>
                <button class="chip" data-id="rent">Нужен (+₽1 500/мес)</button>
              </div>
            </div>

            <div class="row">
              <div class="label">Ожидаемая доставляемость</div>
              <div class="rangeWrap">
                <input id="dlr" type="range" min="80" max="99" value="95" step="1">
                <div class="hint"><span>80%</span><span id="dlrOut">95%</span><span>99%</span></div>
              </div>
              <div class="note">Биллинг обычно по отправленным. Показатель доставляемости — для прогноза «дошедших» сообщений.</div>
            </div>

          </div>
        </div>
      </div>

      <!-- RIGHT: Result -->
      <div class="card">
        <div class="body">
          <h3 class="h3">Итоги</h3>
          <div class="summary" id="summary"></div>
          <div class="summary" id="breakdown" style="margin-top:8px"></div>
          <div class="foot" style="margin-top:12px">
            <button class="primary" id="cta">Устал считать. Хочу автоматизировать </button>
            <span class="muted">Черновая оценка. Не публичная оферта</span>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Простая тарифная сетка (₽ за сегмент) с объёмными скидками
    const pricing = {
      ru:  { steps: [[0, 1.60],[10000, 1.40],[100000, 1.20]] },
      cis: { steps: [[0, 2.50],[10000, 2.20],[100000, 2.00]] },
      eu:  { steps: [[0, 4.00],[10000, 3.50],[100000, 3.20]] },
      ww:  { steps: [[0, 5.00],[10000, 4.50],[100000, 4.00]] }
    };

    const fees = { alfaMonthly: 1500 };

    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>Array.from(document.querySelectorAll(s));
    const setActive = (wrap, el)=>{ $$(wrap+' .chip').forEach(x=>x.classList.remove('active')); el.classList.add('active'); recalc(); };

    // Bind
    $$('#region .chip').forEach(b=>b.addEventListener('click',()=>setActive('#region',b)));
    $$('#enc .chip').forEach(b=>b.addEventListener('click',()=>setActive('#enc',b)));
    $$('#alfa .chip').forEach(b=>b.addEventListener('click',()=>setActive('#alfa',b)));

    $('#messages').addEventListener('input',e=>{ $('#messagesOut').textContent=intlNum(+e.target.value); recalc(); });
    $('#chars').addEventListener('input',e=>{ $('#charsOut').textContent=e.target.value; recalc(); });
    $('#dlr').addEventListener('input',e=>{ $('#dlrOut').textContent=e.target.value+'%'; recalc(); });
    $('#vat').addEventListener('change', recalc);

    function intlNum(n){ return new Intl.NumberFormat('ru-RU').format(n); }
    function money(v){ return new Intl.NumberFormat('ru-RU',{style:'currency',currency:'RUB',maximumFractionDigits:0}).format(v); }

    function getState(){
      const region = $('#region .chip.active').dataset.id;
      const messages = +$('#messages').value;
      const chars = +$('#chars').value;
      const enc = $('#enc .chip.active').dataset.id; // gsm | uni
      const alfa = $('#alfa .chip.active').dataset.id; // none | rent
      const withVAT = $('#vat').checked;
      const dlr = +$('#dlr').value / 100;
      return { region, messages, chars, enc, alfa, withVAT, dlr };
    }

    function segmentsPerMessage(chars, enc){
      const single = enc==='gsm' ? 160 : 70;
      const concat = enc==='gsm' ? 153 : 67;
      if (chars <= single) return 1;
      return Math.ceil(chars / concat);
    }

    function pricePerSegment(region, volume){
      const steps = pricing[region].steps;
      let price = steps[0][1];
      for (const [from, p] of steps){ if (volume >= from) price = p; }
      return price;
    }

    function recalc(){
      const s = getState();
      const segPerMsg = segmentsPerMessage(s.chars, s.enc);
      const totalSegments = segPerMsg * s.messages;
      const unit = pricePerSegment(s.region, s.messages);
      const alfaFee = s.alfa==='rent' ? fees.alfaMonthly : 0;

      let monthly = totalSegments * unit + alfaFee; // биллинг по отправленным
      const vatRate = s.withVAT ? 0.20 : 0;
      const monthlyVAT = monthly * vatRate;
      const total = monthly + monthlyVAT;

      const delivered = Math.round(s.messages * s.dlr);

      // Render summary
      $('#summary').innerHTML = `
        <div class="line"><div>Итого за месяц</div><div class="big">${money(total)}</div></div>
        <div class="line"><div class="muted">Без НДС</div><div>${money(monthly)}</div></div>
        <div class="line"><div class="muted">Цена за 1 сегмент</div><div>${money(unit)}</div></div>
        <div class="line"><div class="muted">Цена за 1000 сообщений*</div><div>${money(unit * segPerMsg * 1000)}</div></div>
        <div class="line"><div class="muted">Оценка «дошедших»</div><div>${intlNum(delivered)} из ${intlNum(s.messages)}</div></div>
      `;

      // Breakdown
      $('#breakdown').innerHTML = `
        <div class="line"><div>Сегментов на 1 сообщение</div><div>${segPerMsg}</div></div>
        <div class="line"><div>Всего сегментов</div><div>${intlNum(totalSegments)}</div></div>
        <div class="line"><div>Тариф (регион)</div><div>${unit.toFixed(2)} ₽ / сегмент</div></div>
        <div class="line"><div>Альфа‑имя</div><div>${alfaFee? money(alfaFee)+' / мес':'—'}</div></div>
        <div class="line"><div>НДС (20%)</div><div>${money(monthlyVAT)}</div></div>
        <div class="note">* Цена за 1000 сообщений рассчитывается при выбранной длине и кодировке.</div>
      `;
    }

    // CTA
    $('#cta').addEventListener('click',()=>{
      const s = getState();
      console.log('LEAD_SMS', s);
      alert('Заявка отправлена. Мы свяжемся для уточнения маршрутов и альфа‑имени.');
    });

    // init
    recalc();
  </script>
</body>
</html>

